---
title: "Question A"
output: html_notebook
---

Setup
```{r}
library(skimr)  
library(ggplot2)
library(hrbrthemes)   
library(forcats)  

# clean all
rm(list=ls())

# working dir
wdir_fg = "/Users/francescogemignani/Google Drive/SMD/_Risk-of-business-failure/git"
wdir_ff = "C:/Users/falle/OneDrive - University of Pisa/Data Science/Statistical Methods for Data Science/smdproject2021"
wdir_sc = "/Users/samuele/University/2.SMD/Risk-of-Business-Failure"
setwd(wdir_fg)
```


#####
#Age#
#####

Import & Summary
```{r}
# import aida dataset
load("../age_df.RData") # reload energy dataset

#summary
skim(age.df)

#dataset
head(age.df)
```
Histogram
```{r}
ggplot(data = age.df) + 
  geom_histogram(mapping=aes(x=Age, fill=Failed),binwidth = 2,color="#e9ecef", alpha=0.6, position = 'identity') +
    scale_fill_manual(values=c("#69b3a2", "#404080"))+
    theme_ipsum() +
    labs(fill='Failed')
```


######
#Size#
######

Import & Summary
```{r}
# import aida dataset
load("../size_df.RData") # reload energy dataset

#summary
skim(size.df)

#dataset
head(size.df)
```
Size Density
```{r}
# ggplot2 size plots

ggplot( data=size.df, aes(x=Total.assetsth.EURLast.avail..yr) ) +
    geom_density(fill="#69b3a2", color="#e9ecef", alpha=0.8)

ggplot(data=size.df, aes(x=Total.assetsth.EURLast.avail..yr, group=Failed, fill=Failed)) +
    geom_density(adjust=1.5, alpha=.4) +
    theme_ipsum()
```



#####
#ROI#
#####

Import & Summary
```{r}
# import aida dataset
load("../roi_df.RData") # reload energy dataset

#summary
skim(roi.df)

#dataset
head(roi.df)
```

ROI Histogram
```{r}
ggplot(data = roi.df) + 
  geom_histogram(mapping=aes(x=avg.roi, fill=Failed),binwidth = 1,color="#e9ecef", alpha=0.6, position = 'identity') +
    scale_fill_manual(values=c("#69b3a2", "#404080"))+
    theme_ipsum() +
    labs(fill='Failed')
```




##########
#SOLVENCY#
##########

Import & Summary
```{r}
# import aida dataset
load("../solvency_df.RData") # reload energy dataset

#summary
skim(solvency.df)

#dataset
head(solvency.df)
```

Solvency Histogram
```{r}
ggplot(data = solvency.df) + 
  geom_histogram(mapping=aes(x=avg.solvency, fill=Failed),binwidth = 2,color="#e9ecef", alpha=0.6, position = 'identity') +
    scale_fill_manual(values=c("#69b3a2", "#404080"))+
    theme_ipsum() +
    labs(fill='Failed')
```



QUESTION A
Compare the distributions of size/age/other between failed and active companies at a specific year?

1.Abbiamo definito age, size°, roi° e solvency.ratio°.     ° = media sui 3 anni precedenti
  - Quali e quante variabili dobbiamo confrontare nella domanda A? 
  - Cosa intende per specific year? Devo filtrare un anno specifico quindi ridimensionare il dataset?

2. siamo in grado di rispondere alla domanda A nello stato in cui ci troviamo adesso?
  - Posso utilizzare ad esempio un approccio non parametrico come la KDE appena vista a lezione per rispondere alle domande?
  - fhat = kde.boundary(x=age,xmin=0, xmax=118,boundary.kernel="beta") su age non termina più...
  - se uso density(age) mi restituisce cmq una boundary kde? il bandwitch sceglie quello ottimale?

3. Se metto la densità (freq = False) la somma delle densità torna sempre un valore diverso 
hist(age.df$Age,freq=FALSE,breaks=1)   #la somma della densità ritorna 1
hist(age.df$Age,freq=FALSE,breaks=120) #la somma della densità ritorna 100
hist(age.df$Age,freq=FALSE,breaks=11,ylim=c(0.0,1.0)) #la somma della densità ritorna 0.1
hist(age.df$Age,freq=FALSE,breaks="Sturges") #la somma della densità ritorna ?


4. la anomaly dectection vista a lezione (IQR range) mi permette di trovare/eliminare gli outliers all'esterno degli intervalli <Q1-1.5*IQR e >Q3+1.5 IQR. E' necessario determinare le anomalie per rispondere alle domande A e B o è più utile eliminarle solo quando facciamo la regressione (sensibile agli outliers)?
Perchè dopo aver eliminato le anomalie all esterno dei whiskers se rieseguo il boxplot sulla nuova variabile si ripresentano ancora anomalie?

5. stesso discorso feature reduction. Non ha senso per le domande a e b, in tali casi eseguo il preprocess solo degli attributi che sto considerando. Ha senso farla solo nel caso della regressione nel nostro caso?

6. istogrammii e grafi preferisce con ggplot2 o con le funzioni (hist,barplot,lines...) viste a lezione? I grafici con ggplot2 sono belli ma non mi permettono ad esempio di avere il pieno controllo...esempio bandwitch, binsize ecc...