---
title: "Question A.CTD"
output: html_notebook
---

Setup
```{r}
library(skimr)  
library(ggplot2)
library(hrbrthemes)   
library(forcats)  

# clean all
rm(list=ls())

# working dir
wdir_fg = "/Users/francescogemignani/Google Drive/SMD/_Risk-of-business-failure/git"
wdir_ff = "C:/Users/falle/OneDrive - University of Pisa/Data Science/Statistical Methods for Data Science/smdproject2021"
wdir_sc = "/Users/samuele/University/2.SMD/Risk-of-Business-Failure"
setwd(wdir_fg)
```

*########################################## QUESTION A CTD ################################################*
*A.ctd Compare the distributions of age/size/roi of failed companies over time*
*A.1.ctd Does it change for a specific company form (i.e. SPA,SRL,etc)?*
*A.2.ctd Does it change for a specific location (i.e. Tuscany,Lombardy,etc.)?*
*##########################################################################################################*

*###############*
*##### AGE #####*
*###############*

Company ages summary
```{r}
# import age dcompany ata
load("./dataset/aida.age.RData") 

#summary
skim(aida.age)

#dataset
head(aida.age)
```

Filter ages of failed company for an interval of year
```{r}
# Filtering ages of all failed companies
aida.age.failed <- aida.age[aida.age$Failed=='Yes',]

# We compare the distribution of age if failed companies over two years
table(aida.age.failed$Last.accounting.closing.date)

# Filtering ages of all failed companies over years
aida.age.failed <- aida.age.failed[aida.age.failed$Last.accounting.closing.date == 2017 | aida.age.failed$Last.accounting.closing.date == 2018 ,]

rm(aida.age)
```

Density of Age of Failed Companies Over Years selected
```{r}
# density of age of failed companies over years selected
ggplot(data=aida.age.failed, aes(x=Age, group=as.factor(Last.accounting.closing.date), fill=as.factor(Last.accounting.closing.date))) +
    geom_density(adjust=1.5, alpha=.4) +
    theme_ipsum() + 
    ggtitle("Density of Ages of Failed Companies Over Time")

```

A.ctd Compare the distributions of AGE of failed companies over selected years
```{r}
age.y1.failed <- aida.age.failed[aida.age.failed$Last.accounting.closing.date == 2017,'Age']
age.y2.failed <- aida.age.failed[aida.age.failed$Last.accounting.closing.date == 2018,'Age']

t.test(age.y1.failed,age.y2.failed)
t.test(age.y1.failed,age.y2.failed,alternative = 'less')
t.test(age.y1.failed,age.y2.failed,alternative = 'greater')

# Remove data from stack
rm(age.y1.failed,age.y2.failed)

# RISULTATO: H0 non significative p-value molto basso. Considero l'ipotesi bilaterale maggiore con p-value = 1
# La media dell'età delle aziende fallite nel 2017 è superiore alla media dell'età delle aziende fallite nel 2018.
# Quindi le aziende fallite nel 2017 sono più vecchie di quelle fallite nel 2018.
```

A.1.ctd Does AGE change for a specific company form (i.e. SPA,SRL,etc)?
```{r}
# List of unique legal form values
company.forms <- unique(aida.age.failed$Legal.form)

table(aida.age.failed$Legal.form)

for(form.name in company.forms){
  print("**************************")
  print(form.name)
  age.y1.failed <- aida.age.failed[aida.age.failed$Last.accounting.closing.date == 2017 & aida.age.failed$Legal.form==form.name ,'Age']
  age.y2.failed <- aida.age.failed[aida.age.failed$Last.accounting.closing.date == 2018 & aida.age.failed$Legal.form==form.name ,'Age']
  
  if( length(age.y1.failed)>3 & length(age.y2.failed)>3 ){
    print(t.test(age.y1.failed,age.y2.failed))
    print(t.test(age.y1.failed,age.y2.failed,alternative = 'less'))
    print(t.test(age.y1.failed,age.y2.failed,alternative = 'greater'))
    }
  else print("Non ci sono abbastanza osservazioni")
  
  # Remove data from stack
  rm(age.y1.failed,age.y2.failed)
}

# RISULTATI
```

A.2.ctd Does AGE change for a specific location (i.e. Tuscany,Lombardy,etc.)?
```{r}
# List of unique legal form values
company.regions <- unique(aida.age.failed$Registered.office.address...Region)
table(aida.age.failed$Registered.office.address...Region)

for(region.name in company.regions){
  print("**************************")
  print(region.name)
  age.y1.failed <- aida.age.failed[aida.age.failed$Last.accounting.closing.date == 2017 & 
                                     aida.age.failed$Registered.office.address...Region==region.name ,'Age']
  age.y2.failed <- aida.age.failed[aida.age.failed$Last.accounting.closing.date == 2018 & 
                                     aida.age.failed$Registered.office.address...Region==region.name ,'Age']
  
  if( length(age.y1.failed)>3 & length(age.y2.failed)>3 ){
    print(t.test(age.y1.failed,age.y2.failed))
    print(t.test(age.y1.failed,age.y2.failed,alternative = 'less'))
    print(t.test(age.y1.failed,age.y2.failed,alternative = 'greater'))
    }
  else print("Non ci sono abbastanza osservazioni")
  
  # Remove data from stack
  rm(age.y1.failed,age.y2.failed)
}

# RISULTATI
```




*###############*
*##### SIZE ####*
*###############*

*###############*
*##### ROI #####*
*###############*

